<!DOCTYPE html>
<html>
    <head>
        <title>Ping Pong Game</title>
    </head>
    <body style="margin: 0px">
        <canvas
            id="canvas"
            width="800"
            height="400"
            style="border: 1px solid black"
        ></canvas>
        <script type="text/javascript" src="js/app.js"></script>
        <script src="js/entities.js"></script>
        <script type="text/javascript">
            var canvas = document.getElementById("canvas");
            var ctx = canvas.getContext("2d");

            const APP_HEIGHT = canvas.height;
            const APP_WIDTH = canvas.width;

            const PADDLE_WIDTH = APP_WIDTH / 32;
            const PADDLE_HEIGHT = APP_HEIGHT / 4;
            const PADDLE_SPEED = 5;
            // Both players paddles start in the middle vertically
            const PADDLE_START_Y =
                Math.floor(APP_HEIGHT / 2) - Math.floor(PADDLE_HEIGHT / 2);

            // Ball is one 80th of the width and one 40th of the height, in the case of 800x400 sized canvas the ball will be a 10 x 10 square
            const BALL_WIDTH = APP_WIDTH / 80;
            const BALL_HEIGHT = APP_HEIGHT / 40;

            // Ball starts in the middle
            const BALL_START_X =
                Math.floor(APP_WIDTH / 2) - Math.floor(BALL_WIDTH / 2);
            const BALL_START_Y =
                Math.floor(APP_HEIGHT / 2) - Math.floor(BALL_HEIGHT / 2);

            var paused = true;

            let resizeCanvas = function () {
                CANVAS_WIDTH = window.innerWidth - 10;
                CANVAS_HEIGHT = window.innerHeight - 10;

                canvas.width = APP_WIDTH;
                canvas.height = APP_HEIGHT;

                canvas.style.width = "" + CANVAS_WIDTH + "px";
                canvas.style.height = "" + CANVAS_HEIGHT + "px";
            };

            resizeCanvas();

            window.addEventListener("resize", function () {
                resizeCanvas();
            });

            app.onInit = function () {
                var player1 = new Player(
                    "player1",
                    0,
                    PADDLE_START_Y,
                    PADDLE_WIDTH,
                    PADDLE_HEIGHT,
                    APP_HEIGHT,
                    "red"
                );
                var player2 = new Player(
                    "player2",
                    APP_WIDTH - PADDLE_WIDTH,
                    PADDLE_START_Y,
                    PADDLE_WIDTH,
                    PADDLE_HEIGHT,
                    APP_HEIGHT,
                    "blue"
                );
                var ball = new Ball(
                    "ball",
                    BALL_START_X,
                    BALL_START_Y,
                    BALL_WIDTH,
                    BALL_HEIGHT,
                    APP_WIDTH,
                    APP_HEIGHT,
                    "black"
                );

                this.nodes.push(player1);
                this.nodes.push(player2);
                this.nodes.push(ball);

                document.onkeydown = function (event) {
                    if (event.keyCode === 83)
                        //s
                        player1.isPressingDown = true;
                    else if (event.keyCode === 87)
                        // w
                        player1.isPressingUp = true;
                    else if (event.keyCode === 40)
                        //down
                        player2.isPressingDown = true;
                    else if (event.keyCode === 38)
                        //up
                        player2.isPressingUp = true;
                    else if (event.keyCode === 32)
                        // spacebar
                        app.pause();
                };

                document.onkeyup = function (event) {
                    if (event.keyCode === 83)
                        //s
                        player1.isPressingDown = false;
                    else if (event.keyCode === 87)
                        // w
                        player1.isPressingUp = false;
                    else if (event.keyCode === 40)
                        //down
                        player2.isPressingDown = false;
                    else if (event.keyCode === 38)
                        //up
                        player2.isPressingUp = false;
                };
            };

            app.onUpdate = function (time) {
                if (paused) {
                    return;
                }

                var player1 = this.getNode("player1");
                var player2 = this.getNode("player2");
                var ball = this.getNode("ball");

                ball.update(player1, player2);
                player1.update();
                player2.update();
            };

            app.pause = function () {
                paused = !paused;
            };

            app.reset = function () {
                var player1 = this.getNode("player1");
                var player2 = this.getNode("player2");
                var ball = this.getNode("ball");
                player1.reset();
                player2.reset();
                ball.initialize();
            };

            app.start = function () {
                // Same as reset but resets the score
                var player1 = this.getNode("player1");
                var player2 = this.getNode("player2");
                player1.points = 0;
                player2.points = 0;
                app.reset();
            };
        </script>
    </body>
</html>
